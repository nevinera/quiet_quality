#!/usr/bin/env ruby

require_relative "../lib/quiet_quality"

tools =
  if ARGV.empty?
    @tools = QuietQuality::Tools::AVAILABLE.values
  else
    @tools = ARGV.map { |t| QuietQuality::Tools::AVAILABLE.fetch(t.to_sym) }
  end

tools.each do |tool|
  warn "================ Running tool #{tool}"
  runner = tool::Runner.new
  output = runner.invoke!

  parser = tool::Parser.new(output)
  messages = parser.messages
  warn "#{messages.count} messages\n"
  messages.each do |msg|
    warn "  #{msg.path}:#{msg.start_line}-#{msg.stop_line}    #{msg.rule}"
    warn "      #{msg.body}"
  end
  warn "\n"
end
